<!DOCTYPE html>
{% load static %}
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <title>{{ movie.name }} - Xem phim</title>
    <link rel="stylesheet" href="{% static 'css/movie.css' %}">
  </head>
  <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #0f0f0f;
        color: #fff;
      }
      .container {
        display: flex;
        max-width: 1200px;
        margin: auto;
        padding: 20px;
      }
      /* Cột trái: poster + info */
      .left {
        flex: 3;
        margin-right: 20px;
      }
      /* Sidebar phải */
      .right {
        flex: 1;
      }
    </style>
  <body>
    {% include "component/indexPage/header.html" %}

    <div class="container">
      <!-- LEFT -->
      <div class="left">
        <!-- Player -->
        <div class="movie-player">
          {% if video_id %}
          <!-- div để YouTube API thay iframe vào -->
          <div id="player"></div>

          <!-- hidden fallback -->
          <div id="embed-error" style="display: none" class="fallback">
            <div class="error-msg">
              Video không thể phát trong trang (embed bị chặn).
            </div>
            <div>
              <a
                id="open-watch"
                href="{{ watch_url }}"
                target="_blank"
                class="btn btn-watch"
                >Xem trực tiếp trên YouTube</a
              >
            </div>
          </div>
          {% else %}
          <div class="fallback">
            <p>Chưa có trailer.</p>
          </div>
          {% endif %}
        </div>

        <!-- Episodes -->
        {% include "component/movie/episodes.html" %}

        <!-- Actors -->
        {% include "component/movie/actors.html" %}

        <!-- Description -->
        {% include "component/movie/description.html" %}

        <!-- Tags -->
        {% include "component/movie/tags.html" %}

        <!-- Recommend -->
        {% include "component/movie/recommend.html" %}
      </div>

      <!-- RIGHT -->
      <div class="right">
        {% include "component/movie/trending.html" %}
      </div>
    </div>

    {% if video_id %}
    <script>
      // load YouTube IFrame API
      (function loadYT() {
        var tag = document.createElement("script");
        tag.src = "https://www.youtube.com/iframe_api";
        var first = document.getElementsByTagName("script")[0];
        first.parentNode.insertBefore(tag, first);
      })();

      var player;
      function onYouTubeIframeAPIReady() {
        player = new YT.Player("player", {
          height: "500",
          width: "100%",
          videoId: "{{ video_id }}",
          playerVars: {
            autoplay: 0,
            controls: 1,
            rel: 0,
            modestbranding: 1,
          },
          events: {
            onError: onPlayerError,
          },
        });
      }

      function onPlayerError(event) {
        var code = event.data;
        console.warn("YT player error", code);
        showEmbedError();
      }

      function showEmbedError() {
        var playerDiv = document.getElementById("player");
        if (playerDiv) playerDiv.style.display = "none";
        var err = document.getElementById("embed-error");
        if (err) err.style.display = "block";
      }

      document.addEventListener("DOMContentLoaded", function () {
        var openWatch = document.getElementById("open-watch");
        if (openWatch) {
          openWatch.href = "{{ watch_url }}";
        }
        setTimeout(function () {
          if (!window.YT || !window.YT.Player) {
            showEmbedError();
          }
        }, 3000);
      });
    </script>
    {% endif %}
  </body>
</html>
